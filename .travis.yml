sudo: required
language: node_js

node_js:
 - 11.13

services:
  - docker

install:
  - npm i # just to be sure
  - docker-compose up -d --build

before_script:
  - docker exec ligapay-adonis npm run lint

script:
  - docker exec ligapay-adonis npm test

deploy:
  provider: script
  branch: develop
  script:
    - curl https://cli-assets.heroku.com/install.sh | sh
    - docker login --username=_ --password=$(heroku auth:token) registry.heroku.com
    - docker tag ligapay:latest registry.heroku.com/$(APP_NAME)/$(HEROKU_PROCESS)
    - docker push registry.heroku.com/$(APP_NAME)/$(HEROKU_PROCESS)
